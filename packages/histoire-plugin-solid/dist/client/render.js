import{render as S,createComponent as h}from"solid-js/web";import{defineComponent as C,h as N,ref as p,watch as w,onMounted as R,onUnmounted as F}from"@histoire/vendors/vue";import*as a from"virtual:$histoire-generated-global-setup";import*as l from"virtual:$histoire-setup";import{HstContext as b,RenderVariant as j,RenderStory as q}from"./components.js";import{syncState as x}from"./util.js";const V=C({name:"RenderStory",props:{variant:{type:Object,required:!0},story:{type:Object,required:!0},slotName:{type:String,default:"default"}},emits:{ready:()=>!0},setup(t,{emit:s}){var m,f;console.log("[histoire-plugin-solid] RenderStory setup() called!",{slotName:t.slotName,story:(m=t.story)==null?void 0:m.title,variant:(f=t.variant)==null?void 0:f.title});const d=p();let n=null,e=null,r=null;async function y(){var v,g;console.log("[histoire-plugin-solid] mountStory called",{story:t.story,variant:t.variant}),e=document.createElement("div"),(v=d.value)==null||v.appendChild(e);const{stop:i}=x(t.variant.state,o=>{});r=i;const u=(g=t.story.file)==null?void 0:g.component;if(console.log("[histoire-plugin-solid] Component:",u,"file:",t.story.file),!u){console.error("[histoire-plugin-solid] No component found!"),s("ready");return}if(n=S(()=>h(b.Provider,{get value(){return{story:t.story,variant:t.variant,slotName:t.slotName}},get children(){return h(u,{Hst:{Story:q,Variant:j}})}}),e),console.log("[histoire-plugin-solid] render() called, dispose:",n),typeof(a==null?void 0:a.setupSolid)=="function"){const o=a.setupSolid;await o({story:t.story,variant:t.variant})}if(typeof(l==null?void 0:l.setupSolid)=="function"){const o=l.setupSolid;await o({story:t.story,variant:t.variant})}if(typeof t.variant.setupApp=="function"){const o=t.variant.setupApp;await o({story:t.story,variant:t.variant})}console.log("[histoire-plugin-solid] emitting ready event"),s("ready")}function c(){var i;r==null||r(),r=null,n==null||n(),n=null,e&&((i=e.parentNode)==null||i.removeChild(e),e=null)}return w(()=>t.story.id,async()=>{c(),await y()}),R(async()=>{console.log("[histoire-plugin-solid] onMounted - mounting story"),await y()}),F(()=>{c()}),{el:d}},render(){return N("div",{ref:"el"})}});export{V as default};
